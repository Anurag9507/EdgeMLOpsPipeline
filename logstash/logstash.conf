input {
  mqtt {
    host => "broker"      # Service name only (no tcp://)
    port => 1883          # Port is a separate field
    topic => "#"
    qos => 0
    # Clean session ensures we don't get duplicate old messages on restart
    clean_session => false 
  }
}

filter {
  # Parse the JSON string into actual fields
  json {
    source => "message"
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "edge-mlops-%{+YYYY.MM.dd}"
  }
  stdout { codec => rubydebug }
}